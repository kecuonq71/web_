let products = {
    data: [
        {
            productName: "nike air force 1 07",
            category: "LIFESTYLE",
            price: 99,
            image: "./img/stylelife/1.JPG",
            quantity: 1,
            detail: "Thiết kế đột phá bắt mắt trải nghiệm bước đi mềm mại. Gia công sắc sảo đường nét tinh tế",
            origin: "Trung Quốc",
            dateOfManufacture: "15/6/2019",
            manufacturer: "Nike"

        },
        {
            productName: "nike dunk high retro",
            category: "LIFESTYLE",
            price: 120,
            image: "./img/stylelife/2.JPG",
            quantity: 1,
            detail: "Thiết kế đột phá bắt mắt trải nghiệm bước đi mềm mại. Gia công sắc sảo đường nét tinh tế",
            origin: "Trung Quốc",
            dateOfManufacture: "17/5/2019",
            manufacturer: "Nike"
        },
        {
            productName: "nike air vapormax 2021 fk",
            category: "LIFESTYLE",
            price: 130,
            image: "./img/stylelife/3.JPG",
            quantity: 1,
            detail: "Thiết kế đột phá bắt mắt trải nghiệm bước đi mềm mại. Gia công sắc sảo đường nét tinh tế",
            origin: "Trung Quốc",
            dateOfManufacture: "15/3/2019",
            manufacturer: "Nike"
        },
        {
            productName: "nike air max 270",
            category: "LIFESTYLE",
            price: 89,
            image: "./img/stylelife/4.JPG",
            quantity: 1,
            detail: "Thiết kế đột phá bắt mắt trải nghiệm bước đi mềm mại. Gia công sắc sảo đường nét tinh tế",
            origin: "Trung Quốc",
            dateOfManufacture: "15/1/2019",
            manufacturer: "Nike"
        },
        {
            productName: "nike air max 290",
            category: "LIFESTYLE",
            price: 50,
            image: "./img/stylelife/5.JPG",
            quantity: 1,
            detail: "Thiết kế đột phá bắt mắt trải nghiệm bước đi mềm mại. Gia công sắc sảo đường nét tinh tế",
            origin: "Trung Quốc",
            dateOfManufacture: "15/10/2019",
            manufacturer: "Nike"
        },

        /*jordan */

        {
            productName: "air jordan 1 mid",
            category: "JORDAN",
            price: 129,
            image: "./img/air/1.JPG",
            quantity: 1,
            detail: "Thiết kế đột phá bắt mắt trải nghiệm bước đi mềm mại. Gia công sắc sảo đường nét tinh tế",
            origin: "Trung Quốc",
            dateOfManufacture: "15/8/2019",
            manufacturer: "Nike"
        },
        {
            productName: "jordan series ES",
            category: "JORDAN",
            price: 89,
            image: "./img/air/2.JPG",
            quantity: 1,
            detail: "Thiết kế đột phá bắt mắt trải nghiệm bước đi mềm mại. Gia công sắc sảo đường nét tinh tế",
            origin: "Trung Quốc",
            dateOfManufacture: "15/5/2019",
            manufacturer: "Nike"
        },
        {
            productName: "air jordan dub zero",
            category: "JORDAN",
            price: 160,
            image: "./img/air/3.JPG",
            quantity: 1,
            detail: "Thiết kế đột phá bắt mắt trải nghiệm bước đi mềm mại. Gia công sắc sảo đường nét tinh tế",
            origin: "Trung Quốc",
            dateOfManufacture: "15/11/2019",
            manufacturer: "Nike"
        },
        {
            productName: "air jordan XXXVII tatum",
            category: "JORDAN",
            price: 205,
            image: "./img/air/4.JPG",
            quantity: 1,
            detail: "Thiết kế đột phá bắt mắt trải nghiệm bước đi mềm mại. Gia công sắc sảo đường nét tinh tế",
            origin: "Trung Quốc",
            dateOfManufacture: "15/12/2019",
            manufacturer: "Nike"
        },
        {
            productName: "air jordan 7 retro SE",
            category: "JORDAN",
            price: 210,
            image: "./img/air/5.JPG",
            quantity: 1,
            detail: "Thiết kế đột phá bắt mắt trải nghiệm bước đi mềm mại. Gia công sắc sảo đường nét tinh tế",
            origin: "Trung Quốc",
            dateOfManufacture: "15/2/2019",
            manufacturer: "Nike"
        },
        {
            productName: "air jordan zoom cmft",
            category: "JORDAN",
            price: 150,
            image: "./img/air/6.JPG",
            quantity: 1,
            detail: "Thiết kế đột phá bắt mắt trải nghiệm bước đi mềm mại. Gia công sắc sảo đường nét tinh tế",
            origin: "Trung Quốc",
            dateOfManufacture: "15/4/2019",
            manufacturer: "Nike"
        },

        /* BASEKETBALL */

        {
            productName: "Lebron XX trinity ",
            category: "BASEKETBALL",
            price: 200,
            image: "./img/baseketball/1.JPG",
            quantity: 1,
            detail: "Thiết kế đột phá bắt mắt trải nghiệm bước đi mềm mại. Gia công sắc sảo đường nét tinh tế",
            origin: "Trung Quốc",
            dateOfManufacture: "15/6/2019",
            manufacturer: "Nike"
        },
        {
            productName: "nike air zoom g.t. cut 2 ",
            category: "BASEKETBALL",
            price: 170,
            image: "./img/baseketball/2.JPG",
            quantity: 1,
            detail: "Thiết kế đột phá bắt mắt trải nghiệm bước đi mềm mại. Gia công sắc sảo đường nét tinh tế",
            origin: "Trung Quốc",
            dateOfManufacture: "15/6/2019",
            manufacturer: "Nike"
        },
        {
            productName: "zoom freak 4 birthstone ",
            category: "BASEKETBALL",
            price: 130,
            image: "./img/baseketball/3.JPG",
            quantity: 1,
            detail: "Thiết kế đột phá bắt mắt trải nghiệm bước đi mềm mại. Gia công sắc sảo đường nét tinh tế",
            origin: "Trung Quốc",
            dateOfManufacture: "19/6/2021",
            manufacturer: "Nike"
        },
        {
            productName: "kd15 naphessa collier ",
            category: "BASEKETBALL",
            price: 150,
            image: "./img/baseketball/4.JPG",
            quantity: 1,
            detail: "Thiết kế đột phá bắt mắt trải nghiệm bước đi mềm mại. Gia công sắc sảo đường nét tinh tế",
            origin: "Trung Quốc",
            dateOfManufacture: "21/6/2020",
            manufacturer: "Nike"
        },
        {
            productName: "kyrie low 5 ",
            category: "BASEKETBALL",
            price: 109,
            image: "./img/baseketball/5.JPG",
            quantity: 1,
            detail: "Thiết kế đột phá bắt mắt trải nghiệm bước đi mềm mại. Gia công sắc sảo đường nét tinh tế",
            origin: "Trung Quốc",
            dateOfManufacture: "29/6/2019",
            manufacturer: "Nike"
        },
    ],
};

// function displayProducts() {
//     const items = products.data.reduce((result, product) => {
//         return result + `
//              <div class="col-sm-12 d-flex my-3 item col-md-6 col-lg-4">
//                 <div class="overlay">
//                      <img class ="sale_img" src="${product.image}" alt="${product.id} width="200px" height="200px"">
//                 <a href="#detail">   <button class ="btn btn-danger detail" onclick="detailItem('${product.productName}')">Chi tiết</button></a>
//                 </div>
//                  <div class="sale_text">
//                     <div>
//                          <p class = "sale_decs">${product.productName}</p>
//                          <p class = "sale_price">${product.price}$</p>
//                          <span>
//                             <button class ="btn btn-success" onclick="addToCart('${product.productName}')">
//                                 <i class="fa-solid fa-bag-shopping"></i> Add Cart
//                             </button>
//                         </span>
//                     </div>
//                  </div>
//              </div>
//         `
//     }, "")
//     document.querySelector(".product_item").innerHTML = items;
// }
// displayProducts()

function displayProductsFromLocalStorage() {
    // Lấy danh sách sản phẩm từ localStorage
    const storedProducts = localStorage.getItem('product');

    // Kiểm tra xem có sản phẩm trong localStorage không
    if (storedProducts) {
        // Chuyển chuỗi JSON thành đối tượng JavaScript
        const products = JSON.parse(storedProducts);

        // Tạo chuỗi HTML để hiển thị sản phẩm
        const items = products.reduce((result, product) => {
            return result + `
                <div class="col-sm-12 d-flex my-3 item col-md-6 col-lg-4">
                    <div class="overlay">
                        <img class ="sale_img" src="${product.image}" alt="${product.id}" width="200px" height="200px">
                        <a href="#detail"><button class ="btn btn-danger detail" onclick="detailItem('${product.productName}')">Chi tiết</button></a>
                    </div>
                    <div class="sale_text">
                        <div>
                            <p class="sale_decs">${product.productName}</p>
                            <p class="sale_price">${product.price}$</p>
                            <span>
                                <button class="btn btn-success" onclick="addToCart('${product.productName}')">
                                    <i class="fa-solid fa-bag-shopping"></i> Add Cart
                                </button>
                            </span>
                        </div>
                    </div>
                </div>
            `;
        }, "");

        // Hiển thị sản phẩm trên trang web
        document.querySelector(".product_item").innerHTML = items;
    } else {
        // Hiển thị thông báo nếu không có sản phẩm trong localStorage
        document.querySelector(".product_item").innerHTML = "<p>Không có sản phẩm nào.</p>";
    }
}

// Gọi hàm để hiển thị sản phẩm từ localStorage khi trang web được tải
displayProductsFromLocalStorage();



const search = () => {
    let input = document.querySelector(".search").value;
    // danh sách sp search theo category

    console.log(searchByCategory);
    // danh sách sản phẩm search theo tên  
    let searchByName = products.data.filter((item) => item.productName === input)
    if (!input) {
        displayProducts()
        return
    }
    if (searchByName) {
        showProductAfterSearch(searchByName)
        return
    }
}
const searchByCategory = () => {
    let input = document.getElementById("slv").value
    let searchByCategory = products.data.filter((item) => item.category === input)
    if (!input) {
        displayProducts()
        return
    }
    showProductAfterSearch(searchByCategory)
}
const showProductAfterSearch = (items) => {
    const product = items.reduce((result, product) => {
        return result + `
        <div class="col-sm-12 d-flex my-3 item col-md-6 col-lg-4">
        <div class="overlay">
             <img class ="sale_img" src="${product.image}" alt="${product.id} width="200px" height="200px"">
             <a href="#detail"><button class ="btn btn-danger detail" onclick="detailItem('${product.productName}')">Chi tiết</button></a>
        </div>
         <div class="sale_text">
            <div>
                 <p class = "sale_decs">${product.productName}</p>
                 <p class = "sale_price">${product.price}$</p>
                 <span>
                    <button class ="btn btn-success" onclick="addToCart('${product.productName}')">
                        <i class="fa-solid fa-bag-shopping"></i> Add Cart
                    </button>
                </span>
            </div>
         </div>
     </div>
        `
    }, "")
    document.querySelector(".product_item").innerHTML = product;
}
const searchByPrice = () => {
    let index = +document.getElementById("pr").value;
    let newListProduct = [];
    if (index === 1) {
        newListProduct = products.data.filter((item) => item.price < 100)
    } if (index === 2) {
        newListProduct = products.data.filter((item) => item.price >= 100 && item.price < 150)

    } if (index === 3) {
        newListProduct = products.data.filter((item) => item.price >= 150);

    }
    if (!index) {
        newListProduct = products.data
    }
    showProductAfterSearch(newListProduct)
}
const detailItem = (item) => {
    document.getElementById("detail").style.display = "block";
    const x = products.data.filter((sp) => sp.productName === item)
    const output = x.reduce((result, sp) => {
        return result + `
            <tr>
            <th>Tên sản phẩm</th>
                <td>${sp.productName}</td>
            </tr>
            <tr>
            <th>Giá</th>
                <td>${sp.price}$</td>
            </tr>
            <tr>
            <th>Hình ảnh</th>

                 <td><img src="${sp.image}" width="60px" height="60px"></td>
            </tr>
            <tr>
            <th>Xuất xứ</th>

                 <td>${sp.origin}</td>
            </tr>
            <tr>
            <th>Thể loại</th>

                 <td>${sp.category}</td>
            </tr>
            <tr>
            <th>Ngày sản xuất</th>

                 <td>${sp.dateOfManufacture}</td>
            </tr>
            <tr>
            <th>Hãng sản xuất</th>

                 <td>${sp.manufacturer}</td>
            </tr>
            <tr>
            <th>Mô tả</th>
                  <td>  
                       ${sp.detail}
                 </td>
            </tr>
        `
    }, "")
    document.getElementById("tbody").innerHTML = output;
}

localStorage.setItem("products", JSON.stringify(products.data));

let slideIndex = 0;
showSlides();

function showSlides() {
    let i;
    let slides = document.getElementsByClassName("mySlides");
    let dots = document.getElementsByClassName("dot");
    for (i = 0; i < slides.length; i++) {
        slides[i].style.display = "none";
    }
    slideIndex++;
    if (slideIndex > slides.length) { slideIndex = 1 }
    for (i = 0; i < dots.length; i++) {
        dots[i].className = dots[i].className.replace(" active", "");
    }
    slides[slideIndex - 1].style.display = "block";
    dots[slideIndex - 1].className += " active";
    setTimeout(showSlides, 2000); // Change image every 2 seconds
}


var cart = [];
//xử lý login
const json = JSON.parse(localStorage.getItem("account")) || null;

var x = [];
if (json) {
    x.push(json)
    document.getElementById("account").innerHTML = x[0].username;
    document.getElementById("logout").innerHTML = "Logout"
}


const addToCart = (productName) => {
    const storedProducts = localStorage.getItem('product');

    // if (!json) {
    //     alert("Vui lòng đang nhập trước khi mua hàng")
    //     return
    // }
    //lấy sản phẩm ra từ object 
    const item = products.data.filter((item) => item.productName === productName);

    //kiểm tra trong giỏ hàng có sp hay chưa

    const index = cart.findIndex((product) => product === item[0])

    // index = -1 => sp đó chưa có trong giở hàng

    if (index === -1) {
        cart.push(...item);
    } else {
        cart[index].quantity += 1;
    }
    displayCart();
}
// const addToCart = (productName) => {
//     // Lấy danh sách sản phẩm từ localStorage với key là 'product'
//     const storedProducts = localStorage.getItem('product');

//     // Kiểm tra xem có sản phẩm trong localStorage không
//     if (storedProducts) {
//         // Chuyển chuỗi JSON thành đối tượng JavaScript
//         const products = JSON.parse(storedProducts);

//         // Kiểm tra xem có thuộc tính 'data' trong đối tượng products hay không
//         if (products && products.data) {
//             // Lấy sản phẩm từ danh sách sản phẩm
//             const item = products.data.filter((item) => item.productName === productName);

//             // Kiểm tra trong giỏ hàng có sản phẩm hay chưa
//             const index = cart.findIndex((product) => product === item[0]);

//             // Nếu sản phẩm chưa có trong giỏ hàng, thêm vào
//             if (index === -1) {
//                 cart.push({ ...item[0], quantity: 1 });
//             } else {
//                 // Nếu sản phẩm đã có trong giỏ hàng, tăng số lượng lên 1
//                 cart[index].quantity += 1;
//             }

//             // Hiển thị giỏ hàng sau khi thêm sản phẩm
//             displayCart();
//         } else {
//             // Hiển thị thông báo nếu không có thuộc tính 'data' trong đối tượng products
//             alert("Dữ liệu sản phẩm không hợp lệ.");
//         }
//     } else {
//         // Hiển thị thông báo nếu không có sản phẩm nào trong localStorage
//         alert("Không có sản phẩm nào trong cửa hàng.");
//     }
// };


//hàm giảm số lượng sp
const decrease = (productName) => {
    const index = cart.findIndex((item) => item.productName === productName);

    if (cart[index].quantity !== 1) {
        cart[index].quantity -= 1;
    }
    else {
        cart.splice(index, 1)
    }
    displayCart()
}
//hàm tăng sl sp
const increase = (productName) => {
    const index = cart.findIndex((item) => item.productName === productName);
    cart[index].quantity += 1;
    displayCart()
}

function displayCart() {
    const output = cart.reduce((result, product) => {
        return result + `
        <tr>
             <td>
                  <img src="${product.image}" width="60px" height="60px">
             </td>
             <td class= "phoneName">${product.productName}</td>
             <td>${product.category}</td>
             <td>${product.price * product.quantity}$</td>
             <td>
                <select id="size" name="size">
                    <option value="36">36</option>
                    <option value="37">37</option>
                    <option value="38">38</option>
                    <option value="39">39</option>
                    <option value="40">40</option>
                    <option value="41">41</option>
                    <option value="42">42</option>
                    <option value="43">43</option>
                    <option value="44">44</option>
                </select>
             </td>

             <td>
                <button class ="btn btn-danger" onclick="decrease('${product.productName}')">-</button>
                ${product.quantity}
                <button class ="btn btn-success" onclick="increase('${product.productName}')">+</button>
             </td>
        </tr>
        `
    }, "")
    const tongTien = cart.reduce((result, item) => {
        return result + (item.price * item.quantity);
    }, 0)
    document.getElementById("tongTien").innerHTML = tongTien;
    document.querySelector("#cart-item").innerHTML = output;
}
document.getElementById("btn-purchase").addEventListener("click", () => {
    if (cart.length === 0) {
        false;
    } else {
        document.getElementById("pay-Modal").style.display = "block";
        const tongTien = cart.reduce((result, item) => {
            return result + (item.price * item.quantity);
        }, 0)
        document.getElementById("totalcart").innerHTML = tongTien;
        cart = [];
        displayCart();
    }
});

function end() {
    document.getElementById("pay-Modal").style.display = "none";
}
